from PIL import Image
import os

def resize_image_half_pil(input_path, output_path):
    """
    使用 Pillow 库将图片调整为原来的一半大小。
    """
    try:
        # 1. 打开图片
        # 使用 with 语句可以确保图片在使用后正确关闭
        with Image.open(input_path) as img:
            # 获取原始尺寸 (注意 PIL 的 size 是 (width, height))
            original_width, original_height = img.size
            print(f"原始尺寸: {original_width}x{original_height}")

            # 2. 计算新的尺寸 (必须是整数)
            # 使用 // 进行整除，或者用 int() 转换
            new_width = int(original_width * 0.5)
            new_height = int(original_height * 0.5)
            print(f"目标尺寸: {new_width}x{new_height}")

            # 3. 调整大小
            # 使用 LANCZOS 滤镜以获得高质量的下采样结果
            resized_img = img.resize((new_width, new_height), Image.Resampling.LANCZOS)

            # 4. 保存图片
            # Pillow 会根据文件扩展名自动判断保存格式 (如 .jpg, .png)
            resized_img.save(output_path, quality=95) # quality仅对JPG有效，可选
            print(f"成功保存调整后的图片至: {output_path}")

    except FileNotFoundError:
        print(f"错误: 找不到文件 {input_path}")
    except Exception as e:
        print(f"发生错误: {e}")

# --- 使用示例 ---

# 假设你当前目录下有一张名为 "example.jpg" 的图片
input_image_file = "example.jpg"
# 指定输出文件名
output_image_file = "example_half_pil.jpg"

# 为了测试，我们需要先创建一个假图片（如果你本地有图片，可以跳过这一步，直接修改上面的文件名）
if not os.path.exists(input_image_file):
    print(f"正在创建测试图片 {input_image_file}...")
    test_img = Image.new('RGB', (800, 600), color='red')
    test_img.save(input_image_file)

# 执行调整大小函数
resize_image_half_pil(input_image_file, output_image_file)
